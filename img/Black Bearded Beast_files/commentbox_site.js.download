var CBCore={},isEditMode=!1,comment_content="";CBCore.util={getCmtsSummaryViewType:function(){for(var e=[],t=$D.getAll("[data-comments-summary]",document),a=0;a<t.length;a++){var r=t[a];e[a]=r.dataset.commentsSummary}return e},getTopContainer:function(e,t){for(;e.parentNode;)if((e=e.parentNode).tagName===t)return e;return null},clearFields:function(e){for(var t=e.elements,a=0;a<t.length;a++)"text"!=t[a].type&&"textarea"!=t[a].type||(t[a].value="")},getCookie:function(e){var t=new RegExp(e+"=[^;]*"),a=document.cookie,r=t.exec(a);if(r){var o=r[0].split("=");return unescape(o[1])}return null}};var CommentBox=function(){function e(e,a){var r={};r.status="all",r.pageNo=1,r.pageId=zs_resource_id;var o={};o.node=e,o.data=a;var n=L.getCmtsSummaryViewType();n.length>0&&(r.types=n,o.holder=n),$X.get({url:"/siteapps/commentbox/commentboxComments",params:r,handler:t,args:o})}function t(e){var t=this.responseText,r=JSON.parse(t),o=e.data.loaded,n=r.comment_details;if(0==n.commentbox_type||0!=r.cb_obj.form_view_mode||r.cb_obj.is_enabled){if(1==n.commentbox_type&&n.is_closed){var i=document.createElement("div");if(i.innerHTML=r.cb_data,0==n.comments_length){var c=i.querySelectorAll("[id=zpcomment-list-container]");c&&c.length>0&&(c[0].parentNode.removeChild(c[0]),r.cb_data=i.innerHTML)}else if(n.comments_length>0){var m=$D.getAll("[data-cbform-elmtype=reply_link]",i);Array.prototype.forEach.call(m,function(e){e.parentNode.removeChild(e)}),r.cb_data=i.innerHTML}}e.node.innerHTML=r.cb_data,e.cb_obj=r.cb_obj,O(r.cbform_data),a(r,e),$(e),x(e),o(),function(e,t){var a,r=e.commentbox_comments;null!=document.querySelector("script#schemagenerator")?a=JSON.parse(document.querySelector("script#schemagenerator").innerText):null!=document.querySelector('script[type="application/ld+json"]')&&(a=JSON.parse(document.querySelector('script[type="application/ld+json"]').innerText));var o=new Array;r.forEach(function(e){var t={};if(t["@type"]="Review",0!=e.acquired_rating){var a={};a["@type"]="Rating",a.ratingValue=e.acquired_rating,t.reviewRating=a}var r={};r["@type"]="Person",r.name=e.author_name,t.author=r,""!=e.comment_content&&null!=e.comment_content&&(t.reviewBody=e.comment_content),o.push(t)}),a.filter(function(e){return"Product"==e["@type"]}).forEach(function(t){t.review=o,e.total_ratings>0&&(t.aggregateRating={},t.aggregateRating.ratingCount=e.total_ratings,t.aggregateRating.ratingValue=e.average_rating)});t(a)}(r.r_obj,_)}else{var l=$D.get("[data-comments-other=showhide-rating-review-value]");null!=l&&(l.style.display="none")}}function a(e,t){var a=Object.keys(e);if(t.holder)for(var r=Object.values(e),o=$D.getAll("[data-comments-summary]",document),n=$D.getAll("[data-comments-other]",document),i=0;i<a.length;i++){for(var c=a[i],m=r[i],l=0;l<o.length;l++){(f=o[l]).dataset.commentsSummary+"_data"==c&&(f.innerHTML="",f.innerHTML=m)}if("r_obj"==c&&n.length>0)for(var d=m,s=0;s<n.length;s++){var f;if("showhide-rating-review-value"==(f=n[s]).dataset.commentsOther){var u="block";(0==d.total_comments&&0==d.total_ratings||void 0!==e.cb_obj&&0==e.cb_obj.form_view_mode)&&(u="none"),f.style.display=u}}}}function r(e,t){bindEvent(e,"click",function(e){!function(e,t,a){a.parentNode;var r=a.getAttribute("data-cbform-rootcmt"),n=a.getAttribute("data-cbform-repcmt"),i=$D.get("[data-cbform-elmtype=cb_main_form]",e.node),c={};if(c.in_reply_to=n,c.root_cmt_id=r,c.thisElm=a,null==i)C(e,c);else{var m=i.cloneNode(!0);e.rc_obj=c,o(e,m)}}(t,0,this)})}function o(e,t){var a=e.rc_obj,r=a.thisElm,o=r.parentNode,i=a.in_reply_to,d=e.cb_obj,s=$D.get("[data-cbform-elmtype=cb_comments_list_cont]",e.node);t.setAttribute("data-cbform-commenttype","reply"),t.id="replyform-"+i,t.style.display="",t.setAttribute("data-cbform-rootcmtid",r.getAttribute("data-cbform-rootcmt")),t.removeAttribute("data-cbform-elmtype");var f;if(s.hasAttribute("data-cbform-replyid")){f=s.getAttribute("data-cbform-replyid");var p=$D.get("#replyform-"+f,e.node);p.previousElementSibling.style.display="inline-block",p.parentNode.removeChild(p),s.setAttribute("data-cbform-replyid",i)}else s.setAttribute("data-cbform-replyid",i);for(var b,g=$D.getAll("[data-cbform-elmaction]",t),_=0;_<g.length;_++){var v=g[_];b=v;"changeid"===(w=v.dataset.cbformElmaction)&&b.setAttribute("data-cbform_id",b.getAttribute("data-cbform-elmtype")+"-"+i)}var y=$D.getAll("[data-cbform-elmtype]",t);for(_=0;_<y.length;_++){var h=y[_],w=h.dataset.cbformElmtype;h.hasAttribute("data-cbform-elmaction")&&h.getAttribute("data-cbform-elmaction"),"rating_form"===w&&h.parentNode.removeChild(h),"submit_button"===w&&c(h,e),"reset_button"===w&&(h.style.display="",m(h,e)),"rating_info_dialog_close"===w&&u(h,e)}n(t,e,N,!0),0==d.allowed_users&&L.clearFields(t);var A="-"+i,$=$D.get("[data-cbform_id=guestpost_confirm"+A+"]",t);$&&(D($,t,e),T(t,i)),o.appendChild(t);var E=$D.get("[data-cbform-elmtype=cb_comment_field]",t);E&&(E.value="",E.focus()),r.style.display="none",l("reply",e)}function n(e,t,a,r){var o=$D.get("[data-cbform-elmtype=cb_spamprotect]",e);if(o){if(r){var n=o.childNodes[2];n.parentNode.removeChild(n)}t.captchanode=o,a&&a(o,t)}}function c(e,t){bindEvent(e,"click",function(e){p(t,e)})}function m(e,t){bindEvent(e,"click",function(e){l("cancel",t,e)})}function l(e,t,a){var r=s(t),o=t.cb_obj;if(r){var i;if(a&&a.target&&"cancel"==e&&(i=L.getTopContainer(a.target,"FORM"),"#writeareview"===window.location.hash&&(window.location.hash="")),"reply"===e)r.style.display="none";else if(i&&"cancel"==e&&!j(i)){O(t.node.previousFormStatus),isEditMode=!1;var c=$D.get("[data-cbform-elmtype=write_review]",document);c&&E(c,t)}else"cancel"!==e&&"navigate"!==e||(d(t),r.style.display="",n(r,t,N,!0),0==o.allowed_users&&L.clearFields(r),!isEditMode&&y(t.node),!isEditMode&&T(r),isEditMode=!1)}else{var m="none";"cancel"!==e&&"navigate"!==e||(m="",d(t),isEditMode=!1);$D.get("[data-cbform-elmtype=write_review]",t.node).style.display=m}}function d(e){var t=$D.get("[data-cbform-elmtype=cb_comments_list_cont]",e.node);t&&t.hasAttribute("data-cbform-replyid")&&t.removeAttribute("data-cbform-replyid");var a=k();if(a){a.previousElementSibling.style.display="inline-block",a.parentNode.removeChild(a)}}function s(e){for(var t=$D.getAll("[data-cbform-elmtype=cb_main_form]",e.node),a=0;a<t.length;a++){var r=t[a];if(!r.hasAttribute("data-cbform-commenttype"))return r}}function f(e,t){bindEvent(e,"click",function(e){!function(e,t,a){var r;r=window.innerWidth<768?0:a.offsetLeft+a.offsetWidth-4;var o=a.offsetTop+a.offsetHeight-4,n=$D.get("[data-cbform-elmtype=zpcomment_rating_infobox]",e.node);n.style.display="",n.style.position="absolute",n.style.zIndex="1",n.style.top=o+"px",n.style.left=r+"px",window.innerWidth<768&&(r=(window.innerWidth-n.offsetWidth)/2,n.style.left=r+"px")}(t,0,this)})}function u(e,t){bindEvent(e,"click",function(e){!function(e,t,a){$D.get("[data-cbform-elmtype=zpcomment_rating_infobox]",e.node).style.display="none"}(t)})}function p(e,t){var a=t.target;e.targ=a;var r=L.getTopContainer(a,"FORM"),o=function(e){return $D.get("[data-cbform-contexttype]",e.node)?$D.get("[data-cbform-contexttype]",e.node).getAttribute("data-cbform-contexttype"):"commentbox"}(e),n="",i={};j(r)&&("-"+(n=r.id.replace("replyform-","")),i.root_cmt_id=r.getAttribute("data-cbform-rootcmtid"),i.in_reply_to=n);var c,m,l,d=1;m=l="";var s=r.elements.cbcomment.value;if(s=s.trim(),isEditMode&&""!==comment_content&&""===r.elements.cbcomment.value.trim())return c=i18n.get("review.empty.error.message"),b("form_error",c,e),!1;if(r.elements.cbname&&(m=r.elements.cbname.value,(m=m.trim())&&m.length>100))return c=i18n.get("commentbox.formvalidate.nametoolong"),b("cmt_name_errormsg",c,e),!1;if(r.elements.cbemail){if(l=r.elements.cbemail.value,""!=(l=l.trim())){if(!new RegExp("^[a-zA-Z0-9]([\\w\\-\\.\\+']*)@([\\w\\-\\.]*)(\\.[a-zA-Z]{2,8}(\\.[a-zA-Z]{2}){0,2})$","mig").exec(l))return c=i18n.get("commentbox.formvalidate.emailcorrectformat"),b("cmt_email_errormsg",c,e),!1}if(l&&l.length>100)return c=i18n.get("commentbox.formvalidate.emailtoolong"),b("cmt_email_errormsg",c,e),!1}var f=0,u=r.elements.rating;if(void 0!==u)for(var p=0;p<u.length;p++)u[p]&&u[p].checked&&(f=u[p].value);if(j(r)){var _=$D.get("[data-cbform-pgno]",e.node);_&&(d=_.dataset.cbformPgno)}var v=e.data.util.getData("showratingtoggle");if(""==s&&("false"==v||j(r)||"commentbox"===o))return c=i18n.get(o+".formvalidate.require_comment"),b("common_error_msg",c,e),!1;if(""==s&&0==f)return c=i18n.get(o+".formvalidate.require_rate_comment"),b("common_error_msg",c,e),!1;i.cb_comments_content=s,i.cb_comments_added_by_name=m,i.cb_comments_added_by_emailid=l,i.acquired_rating=f,i.pageId=zs_resource_id,i.pageNo=d,i.csrfp=L.getCookie("csrfc");var y=r.elements.cb_guestpost_confirm;y&&y.checked&&(i.is_guest=1);var h=r.elements.cbcaptcha;if(h){var w=r.elements.cbcaptcha.value;if(""==(w=w.trim()))return c=i18n.get("commentbox.formvalidate.require_captcha"),b("captcha-errormsg",c,e),h.focus(),!1;if(w.length>10)return c=i18n.get("commentbox.formvalidate.captcha_incorrect"),b("captcha-errormsg",c,e),h.value="",h.focus(),!1;var A=r.elements.digest.value;i.cpt=w,i.digest=A}!function(e){e.hasAttribute("disabled")||e.setAttribute("disabled","true")}(a);var $=L.getCmtsSummaryViewType();$.length>0&&(i.types=$,e.holder=$),$X.post({url:"/siteapps/commentbox/addComments",params:i,handler:g,credential:!0,args:e})}function b(e,t,a){var r=$D.get("[data-cbform-elmtype="+e+"]",a.node);r&&(r.innerHTML=t,setTimeout(function(){r.innerHTML=""},4e3))}function g(e){var t=e.targ;v(t);var r=this.responseText,o=JSON.parse(r),i=L.getTopContainer(t,"FORM"),c="";if(j(i)&&"-"+(c=i.id.replace("replyform-","")),0==o.CODE){var m=o.CONTENT;e.node.innerHTML=m.cb_data,O(m.cbform_data),"#writeareview"===window.location.hash&&(window.location.hash="");var l=m.cb_cmt_view.comment_id,d=$D.get("[data-cbform-elmtype=comment-cont-"+l+"]",e.node);d&&d.scrollIntoView({block:"center"}),a(o,e),$(e),isEditMode=!1}else if(1==o.CODE)alert(o.CONTENT),L.clearFields(i),y(e.node),n(i,e,N,!0),T(i,c);else if(2==o.CODE){var s=(m=JSON.parse(o.CONTENT)).ERROR,f=$D.get("[data-cbform-elmtype=captcha-errormsg]",e.node);f.innerHTML=s,setTimeout(function(){f.innerHTML=""},4e3);var u=$D.get("[data-cbform-elmtype=cb_spamprotect]",i),p=u.childNodes[2];p.parentNode.removeChild(p),M(u,m,e);var b=$D.get("[data-cbform-elmtype=cb_captcha]",i);return b.value="",b.focus(),!1}v(t)}function _(e){var t=JSON.stringify(e);null!=document.querySelector("script#schemagenerator")?document.querySelector("script#schemagenerator").innerText=t:null!=document.querySelector('script[type="application/ld+json"]')&&(document.querySelector('script[type="application/ld+json"]').innerText=t)}function v(e){e.hasAttribute("disabled")&&e.removeAttribute("disabled")}function y(e){var t=e.getElementsByTagName("input");if(t)for(var a=0;a<t.length;a++){var r=t[a];"radio"==r.type&&"rating"==r.name&&(r.checked=!1)}}function h(t,a){var r=a.target;k()&&l("navigate",t);var o=r.id.replace("cbComm","").toLowerCase(),n=r.getAttribute("data-cbform-"+o),i={};i.status="all",i.pageId=zs_resource_id,t.event=a,1==n?e(t.node,t.data):$X.get({url:"/siteapps/commentbox/commentboxComments/page/"+n,params:i,handler:w,args:t})}function w(e){var t=this.responseText,a=JSON.parse(t);e.node.innerHTML=a.cb_data,e.cb_obj=a.cb_obj,O(a.cbform_data);var r=e.event.target,o=r.id.replace("cbComm","").toLowerCase();r.getAttribute("data-cbform-"+o);$(e);T(s(e))}function A(e,t){bindEvent(e,"click",function(e){h(t,e)})}function $(e){for(var t,a=$D.getAll("[data-cbform-elmtype]",e.node),o=0;o<a.length;o++){var n=a[o],i=n.dataset.cbformElmtype;n.hasAttribute("data-cbform-elmaction")&&n.getAttribute("data-cbform-elmaction"),"cb_main_form"===i&&(t=n),"submit_button"===i&&c(n,e),"reset_button"===i&&m(n,e),"rating_info_icon"===i&&f(n,e),"rating_info_dialog_close"===i&&u(n,e),"guestpost_confirm"===i&&(D(n,e.node,e),T(t)),"cb_spamprotect"===i&&(e.captchanode=n,N(n,e)),"write_review"===i&&E(n,e)}!function(e){for(var t=$D.getAll("[data-cbform-elmtype=page_navigation]",e.node),a=0;a<t.length;a++){var o=t[a];A(o,e)}for(var n=$D.getAll("[data-cbform-elmtype=reply_link]",e.node),i=0;i<n.length;i++){var c=n[i];2!=e.cb_obj.form_view_mode&&4!=e.cb_obj.form_view_mode&&0!=e.cb_obj.form_view_mode?(c.innerText="Reply",c.style.display="inline-block",$E.unbind(c,"click"),r(c,e)):(c.innerText="",c.style.display="none")}}(e)}function D(e,t,a){bindEvent(e,"click",function(e){!function(e,t,a){var r="",o=!1;if(a){var n=a;if(n.hasAttribute("data-cbform-elmtype")){var i=n.getAttribute("data-cbform-elmtype");if("guestpost_confirm"===i){var c,m=$D.get("[data-cbform-elmtype=name_email_fields]",e);if(n.hasAttribute("data-cbform_id")){var l=n.getAttribute("data-cbform_id"),d=l.split("-");c=d[1],r="-"+c,m=$D.get("[data-cbform_id=name_email_fields"+r+"]",e)}var s=$D.getAll("input",m);o=a.checked;for(var f=0;f<s.length;f++){var u=s[f];"text"==u.type&&(u.value=u.dataset.cbformUdetails,u.disabled=!o,o&&(u.value=""))}}}}}(t,0,this)})}function E(e,t){bindEvent(e,"click",function(e){C(t)}),"#writeareview"===window.location.hash&&C(t)}function C(e,t){var a={},r={};zs_resource_id;t&&(e.rc_obj=t,r.root_cmt_id=t.root_cmt_id,r.in_reply_to=t.in_reply_to),a.domainName=document.location.hostname,$X.get({url:"/siteapps/commentbox/"+zs_resource_id+"/formStatus",headers:a,params:r,handler:t?function(e){var t=this.responseText,a=JSON.parse(t),r=document.createElement("div");r.id="replydummydiv",r.innerHTML=a.cbform_data;var n;for(i=0;i<r.childNodes.length;i++)1==r.childNodes[i].nodeType&&(n=r.childNodes[i]);o(e,n),r.parentNode.removeChild(r)}:function(e){var t=this.responseText,a=JSON.parse(t),r=$D.get("[data-cbform-elmtype=cb_form_field]",document);e.node.previousFormStatus=r.innerHTML,O(a.cbform_data),$D.get("[data-cbform-elmtype=reset_button]").style.display="",$(e),x(e),isEditMode=a.edit_mode,comment_content=$D.get("[data-cbform-elmtype=cb_comment_field]",r).value.trim()},args:e})}function x(e){"#writeareview"===window.location.hash&&$D.get("[data-cbform-elmtype=cb_main_form]",e.node).scrollIntoView()}function T(e,t){var a="",r=$D.get("[data-cbform-elmtype=guestpost_confirm]",e),o=$D.get("[data-cbform-elmtype=name_email_fields]",e);t&&(a="-"+t,r=$D.get("[data-cbform_id=guestpost_confirm"+a+"]",e),o=$D.get("[data-cbform_id=name_email_fields"+a+"]",e)),r.checked=!1;for(var n=$D.getAll("input",o),i=0;i<n.length;i++){var c=n[i];"text"==c.type&&(c.value="",c.value=c.dataset.cbformUdetails,c.disabled=!0)}}function N(e,t){var a=document.createElement("script");a.onload=function(e,t){var a={};a.resource_id=zs_resource_id,$X.get({url:"/siteapps/commentbox/commentCaptcha",params:a,handler:S,args:e})}(t),e.appendChild(a)}function S(e){var t=this.responseText,a=JSON.parse(t);if(a){M(e.captchanode,a,e)}}function M(e,t,a){var r=document.createElement("IMG");r.className="captchaImg",r.src=t.CAPTCHAURL,e.insertBefore(r,e.childNodes[2]);var o=$D.get("[data-cbform-elmtype=cb_captcha_digest]",a.node);o.value=t.DIGEST,e.appendChild(o)}function k(){for(var e,t=document.forms,a=0;a<t.length;a++)t[a].hasAttribute("data-cbform-commenttype")&&"reply"==t[a].getAttribute("data-cbform-commenttype")&&(e=t[a]);return e}function j(e){return!(!e.hasAttribute("data-cbform-commenttype")||"reply"!=e.getAttribute("data-cbform-commenttype"))}function O(e){$D.get("[data-cbform-elmtype=cb_form_field]",document).innerHTML=e}var L=CBCore.util;return bindEvent=function(e,t,a){$E.bind(e,t,a)},unBindEvent=function(e,t,a){$E.unbind(e,t,a)},{init:e,addCBComments:p,paginateCBComments:h,bindEvent:bindEvent}}();